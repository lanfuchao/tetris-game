# v2.1 新功能详解

## 🎚️ 难度系统

### 核心改进

游戏从单一难度升级为**三级难度系统**，每种难度都有独特的游戏体验：

```
简单模式 ──→ 新手友好，充足思考时间
普通模式 ──→ 经典体验，平衡挑战
困难模式 ──→ 极限挑战，快速反应
```

### 难度对比矩阵

| 维度 | 简单 | 普通 | 困难 |
|-----|------|------|------|
| 初始速度 | 1000ms | 800ms | 600ms |
| 最终速度 | 200ms | 120ms | 80ms |
| 达到最快 | ~20级 | ~15级 | ~13级 |
| 分数倍率 | 1.0x | 1.5x | 2.0x |
| 升级要求 | 1200分 | 1000分 | 800分 |
| 难度曲线 | 平缓 | 适中 | 陡峭 |

## 📈 速度算法革新

### 旧算法问题

```typescript
// 线性递减 - v2.0
speed = max(100, 1000 - (level - 1) * 100)
```

**缺陷：**
- ❌ 前10级变化几乎感觉不到
- ❌ 10级后突然变得极快
- ❌ 缺乏平滑过渡
- ❌ 不符合玩家学习曲线

### 新算法优势

```typescript
// 指数衰减 - v2.1
speed = initialSpeed × decayRate^(level - 1)
```

**优势：**
- ✅ 符合指数学习曲线
- ✅ 前期给予充足适应时间
- ✅ 中期保持稳定挑战
- ✅ 后期难度趋于稳定
- ✅ 整体体验更流畅

### 实际速度对比

#### 前 5 级对比
| 等级 | 旧算法 | 新算法(普通) | 差异 |
|-----|-------|-------------|-----|
| 1 | 1000ms | 800ms | 快 20% |
| 2 | 900ms | 704ms | 快 22% |
| 3 | 800ms | 620ms | 快 23% |
| 4 | 700ms | 545ms | 快 22% |
| 5 | 600ms | 480ms | 快 20% |

#### 10-15 级对比
| 等级 | 旧算法 | 新算法(普通) | 差异 |
|-----|-------|-------------|-----|
| 10 | 100ms | 253ms | 慢 153% |
| 11 | 100ms | 222ms | 慢 122% |
| 12 | 100ms | 196ms | 慢 96% |
| 13 | 100ms | 172ms | 慢 72% |
| 14 | 100ms | 152ms | 慢 52% |
| 15 | 100ms | 134ms | 慢 34% |

**结论**: 新算法在高等级时更人性化，避免了"到顶瞬间死亡"的问题。

## 🎮 游戏体验优化

### 简单模式设计理念

```
目标用户: 俄罗斯方块新手
设计重点: 降低学习门槛
速度策略: 极其缓慢的递增
得分策略: 标准分数，关注玩法本身
```

**适合场景:**
- 第一次玩俄罗斯方块
- 休闲娱乐，不追求高分
- 练习基础操作技巧
- 让孩子尝试游戏

### 普通模式设计理念

```
目标用户: 有一定游戏经验的玩家
设计重点: 经典体验 + 适度挑战
速度策略: 平衡的指数递增
得分策略: 1.5倍加成鼓励高分
```

**适合场景:**
- 玩过几次俄罗斯方块
- 追求挑战和成就感
- 想提高游戏技巧
- 日常游戏娱乐

### 困难模式设计理念

```
目标用户: 俄罗斯方块高手
设计重点: 极限反应力挑战
速度策略: 快速的指数递增
得分策略: 2倍加成，高风险高回报
```

**适合场景:**
- 俄罗斯方块老玩家
- 追求极限操作
- 想挑战自我极限
- 竞技向玩家

## 💯 分数系统重构

### 新计分公式

```typescript
实际得分 = 基础分数 × 当前等级 × 难度倍率
```

### 得分示例对比

**场景: 5级，消除2行（基础分300）**

| 难度 | 计算 | 得分 |
|-----|------|-----|
| 简单 | 300 × 5 × 1.0 | 1,500 |
| 普通 | 300 × 5 × 1.5 | 2,250 |
| 困难 | 300 × 5 × 2.0 | 3,000 |

**场景: 10级，消除4行（基础分800）**

| 难度 | 计算 | 得分 |
|-----|------|-----|
| 简单 | 800 × 10 × 1.0 | 8,000 |
| 普通 | 800 × 10 × 1.5 | 12,000 |
| 困难 | 800 × 10 × 2.0 | 16,000 |

### 高分策略

#### 简单模式
- 专注于消除行数
- 不要追求速度
- 尽量消除多行

#### 普通模式
- 平衡速度和准确度
- 利用1.5倍加成
- 中等级时积极消行

#### 困难模式
- 需要极快反应
- 2倍分数但风险高
- 适合短时间冲高分

## 🎯 升级系统改进

### 旧系统
```
所有难度: 每 1000 分升一级
```
- 问题: 困难模式升级太快，体验差

### 新系统
```typescript
等级 = Math.floor(分数 / 升级门槛) + 1
```

| 难度 | 门槛 | 等级1 | 等级2 | 等级3 | 等级10 |
|-----|------|-------|-------|-------|--------|
| 简单 | 1200 | 0-1199 | 1200-2399 | 2400-3599 | 10800-11999 |
| 普通 | 1000 | 0-999 | 1000-1999 | 2000-2999 | 9000-9999 |
| 困难 | 800 | 0-799 | 800-1599 | 1600-2399 | 7200-7999 |

## 🎨 UI/UX 改进

### 新增界面元素

1. **难度选择面板**
   - 三个大按钮，清晰可见
   - 显示难度名称和描述
   - 当前选中高亮显示
   - 游戏中自动禁用

2. **难度信息显示**
   - 得分区域显示当前难度
   - 游戏结束显示难度信息
   - 颜色区分不同难度

3. **交互反馈**
   - 按钮悬停效果
   - 选中状态光晕
   - 禁用状态灰化

### 视觉设计

```css
难度按钮样式:
  - 默认: 半透明白色背景
  - 悬停: 更亮的背景 + 右移动画
  - 选中: 蓝色高亮 + 光晕效果
  - 禁用: 降低透明度 + 禁用光标
```

## 📊 数据可视化

### 速度曲线图

可以使用 `speed-comparison.js` 查看:

```bash
node speed-comparison.js
```

输出包括:
- 各难度在不同等级的速度
- ASCII 趋势图
- 速度公式说明

## 🔧 技术实现

### 模块化设计

```
新增文件:
  src/difficulty.ts    - 难度系统核心

修改文件:
  src/types.ts        - 添加难度类型
  src/game.ts         - 集成难度系统
  src/index.html      - 难度选择UI
  src/styles/main.css - 难度按钮样式
```

### 核心 API

```typescript
// 获取速度
getSpeed(difficulty: Difficulty, level: number): number

// 计算等级
calculateLevel(difficulty: Difficulty, score: number): number

// 获取配置
getDifficultyConfig(difficulty: Difficulty): DifficultyConfig

// 设置难度
game.setDifficulty(Difficulty.HARD)
```

## 🎓 设计原理

### 指数函数的选择

为什么使用指数衰减而非其他曲线？

1. **对数曲线** - 前期下降太快
2. **线性曲线** - 缺乏自然感
3. **二次曲线** - 后期变化过大
4. **指数曲线** ✓ - 最符合人类学习规律

### 衰减率的确定

```
简单: 0.92 (每级减8%)  - 20级达到极限
普通: 0.88 (每级减12%) - 15级达到极限
困难: 0.85 (每级减15%) - 13级达到极限
```

参考了:
- 经典俄罗斯方块游戏数据
- 玩家反馈测试
- 游戏平衡性分析

## 🚀 性能影响

### 计算开销

```typescript
// 旧算法: O(1)
speed = 1000 - (level - 1) * 100

// 新算法: O(1)
speed = 800 * Math.pow(0.88, level - 1)
```

**结论**: 性能影响可忽略，Math.pow() 是原生优化函数。

### 内存占用

- 新增代码: ~2KB (难度系统)
- 配置数据: ~0.5KB
- 总增加: 约 2.5KB

**影响**: 微不足道

## 📈 未来扩展

### 可能的改进方向

1. **自定义难度**
   ```typescript
   createCustomDifficulty({
       initialSpeed: 700,
       decayRate: 0.90,
       minSpeed: 150,
       scoreMultiplier: 1.2
   })
   ```

2. **难度变体**
   - 随机难度（每局随机）
   - 混合难度（中途变化）
   - 自适应难度（根据表现调整）

3. **挑战模式**
   - 速度挑战（固定速度通关）
   - 时间挑战（限时最高分）
   - 生存挑战（坚持最长时间）

## 🎉 玩家收益

### 新手玩家
- ✅ 简单模式降低入门门槛
- ✅ 更长的学习时间
- ✅ 不会被速度吓退

### 普通玩家
- ✅ 更平滑的难度曲线
- ✅ 挑战性与可玩性平衡
- ✅ 1.5倍分数更有成就感

### 高手玩家
- ✅ 困难模式提供真正挑战
- ✅ 2倍分数刷榜利器
- ✅ 极限速度测试反应力

---

**总结**: v2.1 的难度系统是基于游戏设计理论和玩家心理学的重大改进，使游戏更具包容性和挑战性。
